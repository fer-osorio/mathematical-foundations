<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'">
    <title>Elliptic Curve Explorer - Cryptography Portfolio</title>

    <!-- Link to main stylesheets -->
    <link rel="stylesheet" href="../css/main.css">

    <style>
        /* ECC Tool Specific Styles */
        .ec-tool-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: var(--spacing-xl);
        }

        /* REFACTORED: Styles for both canvases */
        .canvas-container {
            width: 100%;
            max-width: 800px;
            margin: var(--spacing-xl) auto;
            background: white;
            border: 2px solid var(--color-border);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-md);
            /* FIX: Ensure container has dimensions even when parent is hidden */
            min-height: 600px;
        }

        .canvas-container canvas {
            width: 100%;
            height: 600px;
            display: block;
            cursor: crosshair;
            /* FIX: Ensure canvas itself has minimum dimensions */
            min-width: 300px;
            min-height: 600px;
        }

        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: var(--spacing-lg);
            margin: var(--spacing-xl) 0;
        }

        /* REMOVED: mode-selector styles (no longer needed) */

        .operation-display {
            background: var(--color-background);
            padding: var(--spacing-md);
            border-radius: var(--border-radius);
            margin: var(--spacing-md) 0;
            font-family: var(--code-font);
        }

        .operation-display p {
            margin: var(--spacing-xs) 0;
        }

        /* NEW: Slider controls for real curve parameters */
        .slider-control {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            margin: var(--spacing-md) 0;
        }

        .slider-control input[type="range"] {
            flex: 1;
        }

        .slider-control .value-display {
            min-width: 3rem;
            text-align: right;
            font-weight: bold;
            color: var(--color-primary);
        }

        @media (max-width: 768px) {
            .ec-tool-container {
                padding: var(--spacing-lg) var(--spacing-md);
            }

            .canvas-container canvas {
                height: 400px;
            }

            .controls-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Header with navigation -->
    <header>
        <nav class="navbar">
            <div class="nav-container">
                <h1 class="logo">Elliptic Curve Explorer</h1>
                <ul class="nav-links">
                    <li><a href="../index.html">‚Üê Back to Portfolio</a></li>
                    <li>
                        <button id="theme-toggle" class="theme-toggle" aria-label="Toggle dark mode">
                            üåë
                        </button>
                    </li>
                </ul>
            </div>
        </nav>
    </header>

    <main class="ec-tool-container">
        <!-- Welcome message -->
        <div id="welcome-message"></div>

        <!-- Error display -->
        <div id="error-message" class="alert alert--error" hidden></div>

        <!-- REFACTORED: Updated tab labels -->
        <div class="tabs">
            <button class="tab-button active" data-tab="visualization">1. Curve Visualization (‚Ñù)</button>
            <button class="tab-button" data-tab="operations">2. Point Operations (F_p)</button>
            <button class="tab-button" data-tab="protocols">3. Protocols (Coming Soon)</button>
            <button class="tab-button" data-tab="security">4. Security Analysis (Coming Soon)</button>
        </div>

        <!-- ====================================================================
             TAB 1: CURVE VISUALIZATION (REAL NUMBERS ONLY)
             REFACTORED: Dedicated to geometric visualization
             ==================================================================== -->
        <div id="visualization" class="tab-panel active">
            <h2>Elliptic Curve Geometry (Real Numbers)</h2>

            <div class="alert alert--info">
                <p><strong>üìê Purpose:</strong> Understand the geometric foundation of elliptic curves over the real numbers (‚Ñù).</p>
                <p>This visualization shows the smooth, continuous curve where the chord-and-tangent method is most intuitive.</p>
            </div>

            <!-- REFACTORED: New curve selector for real curves only -->
            <div class="card card--control">
                <h3>Select Curve Equation</h3>

                <div class="form-group">
                    <label for="real-curve-select">Curve:</label>
                    <select id="real-curve-select">
                        <option value="koblitz" selected>y¬≤ = x¬≥ + 7 (Koblitz-like, similar to secp256k1)</option>
                        <option value="nist-like">y¬≤ = x¬≥ - 3x + 3 (NIST-like, similar to P-256)</option>
                        <option value="generic">y¬≤ = x¬≥ + x + 1 (Generic curve)</option>
                        <option value="custom">Custom parameters...</option>
                    </select>
                </div>

                <!-- REFACTORED: New custom parameter controls with sliders -->
                <div id="custom-real-params" style="display: none;">
                    <h4>Custom Curve: y¬≤ = x¬≥ + ax + b</h4>

                    <div class="slider-control">
                        <label for="real-a">Coefficient a:</label>
                        <input type="range" id="real-a" min="-10" max="10" value="0" step="0.5">
                        <span class="value-display" id="real-a-value">0</span>
                    </div>

                    <div class="slider-control">
                        <label for="real-b">Coefficient b:</label>
                        <input type="range" id="real-b" min="-10" max="10" value="7" step="0.5">
                        <span class="value-display" id="real-b-value">7</span>
                    </div>

                    <p class="info" style="margin-top: 1rem;">
                        <em>Adjust sliders to see how curve shape changes.
                        Non-singular condition: 4a¬≥ + 27b¬≤ ‚â† 0</em>
                    </p>
                </div>
            </div>

            <!-- REFACTORED: New display div for real curve info -->
            <div id="real-curve-info"></div>

            <!-- REFACTORED: Dedicated canvas for real curves -->
            <div class="canvas-container">
                <canvas id="real-curve-canvas"></canvas>
            </div>

            <div class="card card--control">
                <h3>üìö Understanding the Visualization</h3>

                <h4>Curve Equation: y¬≤ = x¬≥ + ax + b</h4>
                <p>This is the <strong>Weierstrass normal form</strong> of an elliptic curve.</p>

                <h4>Key Properties:</h4>
                <ul>
                    <li><strong>Symmetry:</strong> The curve is symmetric about the x-axis (if (x, y) is on the curve, so is (x, -y))</li>
                    <li><strong>Components:</strong> Depending on the discriminant Œî = -16(4a¬≥ + 27b¬≤), the curve may have:
                        <ul>
                            <li>One connected component (Œî < 0) - typical for cryptographic curves</li>
                            <li>Two separate components (Œî > 0) - one oval and one unbounded</li>
                        </ul>
                    </li>
                    <li><strong>Non-singularity:</strong> The curve must satisfy Œî ‚â† 0 to be valid for cryptography</li>
                </ul>

                <h4>Geometric Interpretation:</h4>
                <p>The smooth curve you see here is the foundation for the group law. When we move to finite fields
                (next tab), we'll use the same algebraic formulas, but work with discrete points instead of
                continuous curves.</p>
            </div>
        </div>

        <!-- ====================================================================
             TAB 2: POINT OPERATIONS (FINITE FIELD ONLY)
             REFACTORED: Co-locates visualization with operations
             ==================================================================== -->
        <div id="operations" class="tab-panel">
            <h2>Point Operations (Finite Field F_p)</h2>

            <div class="alert alert--info">
                <p><strong>üî¢ Purpose:</strong> Perform cryptographic operations on elliptic curves over finite fields.</p>
                <p><strong>Instructions:</strong> Click on points in the visualization to select them (up to 2), then use the operation buttons below.</p>
            </div>

            <!-- REFACTORED: New curve selector for finite field curves -->
            <div class="card card--control">
                <h3>Select Curve (Finite Field)</h3>

                <div class="form-group">
                    <label for="finite-curve-select">Curve:</label>
                    <select id="finite-curve-select">
                        <option value="test-23" selected>E(F‚ÇÇ‚ÇÉ): y¬≤ = x¬≥ + 7 (Small, easy to visualize)</option>
                        <option value="test-97">E(F‚Çâ‚Çá): y¬≤ = x¬≥ + 2x + 3 (Medium size)</option>
                        <option value="custom">Custom parameters...</option>
                    </select>
                </div>

                <!-- REFACTORED: Custom finite field parameters -->
                <div id="custom-finite-params" style="display: none;">
                    <h4>Custom Curve: y¬≤ ‚â° x¬≥ + ax + b (mod p)</h4>

                    <div class="form-group">
                        <label for="finite-a">Coefficient a:</label>
                        <input type="number" id="finite-a" value="0">
                    </div>

                    <div class="form-group">
                        <label for="finite-b">Coefficient b:</label>
                        <input type="number" id="finite-b" value="7">
                    </div>

                    <div class="form-group">
                        <label for="finite-p">Prime p (keep small for visualization, p < 200):</label>
                        <input type="number" id="finite-p" value="23" min="2" max="1000">
                    </div>

                    <button class="btn btn-secondary" id="apply-finite-custom-btn">Apply Custom Curve</button>
                </div>
            </div>

            <!-- REFACTORED: New display div for finite curve info -->
            <div id="finite-curve-info"></div>

            <!-- REFACTORED: Dedicated canvas for finite field curves -->
            <div class="canvas-container">
                <canvas id="finite-curve-canvas"></canvas>
            </div>

            <!-- Point operation controls (UNCHANGED structure, updated IDs) -->
            <div class="controls-grid">
                <!-- Point Addition -->
                <div class="card card--control">
                    <h3>Point Addition</h3>
                    <p>Compute P + Q (requires 2 selected points)</p>
                    <button id="point-add-btn" class="btn btn-primary">Compute P + Q</button>
                </div>

                <!-- Point Doubling -->
                <div class="card card--control">
                    <h3>Point Doubling</h3>
                    <p>Compute 2P (requires 1 selected point)</p>
                    <button id="point-double-btn" class="btn btn-primary">Compute 2P</button>
                </div>

                <!-- Scalar Multiplication -->
                <div class="card card--control">
                    <h3>Scalar Multiplication</h3>
                    <p>Compute kP (requires 1 selected point)</p>
                    <div class="form-group">
                        <label for="scalar-input">Scalar k:</label>
                        <input type="number" id="scalar-input" min="1" max="100" value="3" placeholder="Enter scalar k">
                    </div>
                    <button id="scalar-multiply-btn" class="btn btn-primary">Compute kP</button>
                </div>

                <!-- Clear Selection -->
                <div class="card card--control">
                    <h3>Clear Selection</h3>
                    <p>Reset selected points and results</p>
                    <button id="clear-selection-btn" class="btn btn-secondary">Clear Selection</button>
                </div>
            </div>

            <!-- Operation Results -->
            <div id="operation-results"></div>

            <!-- Educational content (UNCHANGED) -->
            <div class="card card--control">
                <h3>üìö Understanding Point Operations</h3>

                <h4>Point Addition (P + Q)</h4>
                <p><strong>Geometric Method (Chord):</strong></p>
                <ol>
                    <li>Draw a line through points P and Q</li>
                    <li>Find where this line intersects the curve (third point R)</li>
                    <li>Reflect R across the x-axis to get P + Q</li>
                </ol>

                <p><strong>Algebraic Formula:</strong></p>
                <p>For P = (x‚ÇÅ, y‚ÇÅ) and Q = (x‚ÇÇ, y‚ÇÇ) with P ‚â† Q:</p>
                <ul>
                    <li>Œª = (y‚ÇÇ - y‚ÇÅ) / (x‚ÇÇ - x‚ÇÅ) mod p</li>
                    <li>x‚ÇÉ = Œª¬≤ - x‚ÇÅ - x‚ÇÇ mod p</li>
                    <li>y‚ÇÉ = Œª(x‚ÇÅ - x‚ÇÉ) - y‚ÇÅ mod p</li>
                </ul>

                <h4>Point Doubling (2P)</h4>
                <p><strong>Geometric Method (Tangent):</strong></p>
                <ol>
                    <li>Draw the tangent line to the curve at point P</li>
                    <li>Find where this tangent intersects the curve (second point R)</li>
                    <li>Reflect R across the x-axis to get 2P</li>
                </ol>

                <p><strong>Algebraic Formula:</strong></p>
                <p>For P = (x‚ÇÅ, y‚ÇÅ):</p>
                <ul>
                    <li>Œª = (3x‚ÇÅ¬≤ + a) / (2y‚ÇÅ) mod p</li>
                    <li>x‚ÇÉ = Œª¬≤ - 2x‚ÇÅ mod p</li>
                    <li>y‚ÇÉ = Œª(x‚ÇÅ - x‚ÇÉ) - y‚ÇÅ mod p</li>
                </ul>

                <h4>Scalar Multiplication (kP)</h4>
                <p><strong>Double-and-Add Algorithm:</strong></p>
                <ol>
                    <li>Express k in binary: k = k‚ÇÄ + k‚ÇÅ¬∑2 + k‚ÇÇ¬∑4 + ...</li>
                    <li>Start with result = ‚àû (point at infinity)</li>
                    <li>For each bit of k (from right to left):
                        <ul>
                            <li>If bit is 1: result = result + current</li>
                            <li>current = 2¬∑current (double)</li>
                        </ul>
                    </li>
                </ol>

                <p><strong>Example:</strong> 13P where 13 = 1101‚ÇÇ = 8 + 4 + 1</p>
                <p>13P = 8P + 4P + P (requires 3 doublings + 2 additions)</p>

                <p><strong>Complexity:</strong> O(log k) operations (very efficient!)</p>
            </div>
        </div>

        <!-- ====================================================================
             TAB 3: PROTOCOLS (PLACEHOLDER - No changes from before)
             ==================================================================== -->
        <div id="protocols" class="tab-panel">
            <h2>Cryptographic Protocols</h2>
            <div class="alert alert--info">
                <p><strong>Coming in Phase 3:</strong></p>
                <ul>
                    <li>ECDH (Elliptic Curve Diffie-Hellman) key exchange simulation</li>
                    <li>ECDSA (Elliptic Curve Digital Signature Algorithm) signing and verification</li>
                    <li>Interactive demonstrations with step-by-step explanations</li>
                    <li><strong>Standard curves (secp256k1, P-256) will be shown here</strong></li>
                </ul>
            </div>
        </div>

        <!-- ====================================================================
             TAB 4: SECURITY ANALYSIS (PLACEHOLDER - No changes from before)
             ==================================================================== -->
        <div id="security" class="tab-panel">
            <h2>Security Analysis</h2>
            <div class="alert alert--info">
                <p><strong>Coming in Phase 4:</strong></p>
                <ul>
                    <li>ECDLP (Elliptic Curve Discrete Logarithm Problem) hardness explanation</li>
                    <li>Parameter validation and attack scenarios</li>
                    <li>Comparison: ECC vs RSA security levels</li>
                    <li>Side-channel attack demonstrations</li>
                </ul>
            </div>
        </div>
    </main>

    <footer>
        <p>&copy; 2025 Cryptography Portfolio. Educational demonstration only.</p>
        <p class="alert alert--security-note">
            <strong>‚ö†Ô∏è Educational Tool:</strong> Small curves shown here are for learning only.
            Real cryptographic applications require 256+ bit curves.
        </p>
    </footer>

    <!-- Load scripts in order (UNCHANGED) -->
    <script src="../js/config.js"></script>
    <script src="../js/ui-utils.js"></script>
    <script src="../js/display-components.js"></script>
    <script src="../js/crypto-demos/math-utils.js"></script>
    <script src="../js/crypto-demos/ec-math-utils.js"></script>
    <script src="../js/crypto-demos/ec-core.js"></script>
    <script src="../js/crypto-demos/ec-visualization.js"></script>
    <script src="../js/crypto-demos/ec-demo.js"></script>
    <script src="../js/dark-mode-toggle.js"></script>
</body>
</html>
